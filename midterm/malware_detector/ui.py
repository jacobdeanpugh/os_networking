import tkinter as tk
from tkinter import filedialog, messagebox
from .signatures import Signature_Manager
from .config import config

class MalwareDetectorUI:
    def __init__(self, root):
        self.root = root
        self.root.title("Malware Detector")
        self.root.geometry("500x500")
        self.signature_manager = Signature_Manager()

        # UI Components
        self.btn_upload = tk.Button(root, text="Scan File", command=self.scan_file)
        self.btn_upload.pack(pady=20)

        self.result_label = tk.Label(root, text="No File Scanned")
        self.result_label.pack(pady=20)

        self.butn_dir = tk.Button(root, text="Scan Directory", command=self.scan_directory)
        self.butn_dir.pack(pady=20)

        self.dirresult_label = tk.Label(root, text="No Directories Scanned")
        self.dirresult_label.pack(pady=20)

    def scan_file(self):
        file_path = filedialog.askopenfilename()
        if not file_path:
            return
        
        result = self.signature_manager.is_file_signature_malware(file_path)

        status = "Malicious ⚠️" if result else "Safe ✅"

        self.result_label.config(text=f"File: {file_path.split('/')[-1]}\nStatus: {status}")

    def scan_directory(self):
        folder_selected = filedialog.askdirectory()

        results = self.signature_manager.recursively_scan_directory(folder_selected)
    
        text = ""
        malware_count = 0
        
        text += f"Number of Files Scanned {len(results)}"
        for key, item in results.items():
             if item:
                  text+= f"\nMalware Detected ⚠️: {key}"

        self.dirresult_label.config(text=text)


def start_ui():
        """Start the Tkinter UI."""
        root = tk.Tk()
        app = MalwareDetectorUI(root)
        root.mainloop()

    
start_ui()